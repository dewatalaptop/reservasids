<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reservasi Dolan Sawah</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #2a9d8f;
      --primary-dark: #264653;
      --secondary: #e9c46a;
      --accent: #f4a261;
      --danger: #e76f51;
      --light: #f8f9fa;
      --dark: #343a40;
      --success: #28a745;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      background-color: #f5f5f5;
      color: var(--dark);
      background-image: url('https://images.unsplash.com/photo-1500382017468-9049fed747ef?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80');
      background-size: cover;
      background-attachment: fixed;
      background-position: center;
      min-height: 100vh;
    }
    
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.85);
      z-index: -1;
    }
    
    header {
      background: linear-gradient(135deg, var(--primary-dark), var(--primary));
      color: white;
      padding: 25px 20px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      position: relative;
      overflow: hidden;
    }
    
    header::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(90deg, var(--secondary), var(--accent));
    }
    
    header h2 {
      font-size: 2.2rem;
      margin-bottom: 5px;
      font-weight: 600;
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
    }
    
    header small {
      display: block;
      font-size: 0.8rem;
      margin-top: 5px;
      color: rgba(255, 255, 255, 0.8);
      font-weight: 300;
    }
    
    .container {
      max-width: 1200px;
      margin: 30px auto;
      padding: 20px;
      background-color: rgba(255, 255, 255, 0.9);
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 20px;
      align-items: center;
    }
    
    select {
      padding: 10px 15px;
      border-radius: 6px;
      border: 1px solid #ddd;
      background-color: white;
      font-family: 'Poppins', sans-serif;
      font-size: 1rem;
      min-width: 200px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(42, 157, 143, 0.2);
    }
    
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 12px;
      margin-top: 25px;
    }
    
    .date {
      background-color: white;
      padding: 15px 10px;
      text-align: center;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      position: relative;
      border: 1px solid #eee;
    }
    
    .date:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      border-color: var(--primary);
    }
    
    .date.has-reservation::after {
      content: '';
      position: absolute;
      top: 5px;
      right: 5px;
      width: 8px;
      height: 8px;
      background-color: var(--success);
      border-radius: 50%;
    }
    
    .date.selected {
      background-color: var(--primary);
      color: white;
      font-weight: 500;
    }
    
    .warning {
      background-color: var(--danger);
      color: white;
      padding: 12px;
      margin-top: 15px;
      border-radius: 6px;
      text-align: center;
      display: none;
      font-weight: 500;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }
    
    .form-popup, .summary {
      margin-top: 25px;
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
      border-top: 4px solid var(--primary);
    }
    
    .form-popup h3, .summary h3 {
      color: var(--primary-dark);
      margin-bottom: 15px;
      font-size: 1.4rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .form-popup h3 i, .summary h3 i {
      color: var(--accent);
    }
    
    button {
      background-color: var(--primary);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
      font-family: 'Poppins', sans-serif;
      font-weight: 500;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    button:hover {
      background-color: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    button.secondary {
      background-color: var(--secondary);
      color: var(--dark);
    }
    
    button.danger {
      background-color: var(--danger);
    }
    
    footer {
      text-align: center;
      font-size: 0.8rem;
      color: white;
      background-color: var(--primary-dark);
      padding: 15px;
      margin-top: 40px;
      position: relative;
    }
    
    footer::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: linear-gradient(90deg, var(--secondary), var(--accent));
    }
    
    .menu-detail {
      margin-top: 8px;
      font-size: 0.85rem;
      color: #555;
      background-color: rgba(233, 196, 106, 0.1);
      padding: 8px;
      border-radius: 5px;
      border-left: 3px solid var(--secondary);
    }
    
    .menu-detail b {
      font-size: 0.9rem;
      display: block;
      margin-bottom: 5px;
      color: var(--primary-dark);
    }
    
    label {
      display: block;
      margin-bottom: 10px;
      font-weight: 500;
      color: var(--primary-dark);
    }
    
    input, select, textarea {
      width: 100%;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ddd;
      margin-top: 5px;
      font-family: 'Poppins', sans-serif;
      transition: all 0.3s;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(42, 157, 143, 0.2);
    }
    
    textarea {
      min-height: 80px;
      resize: vertical;
    }
    
    .reservation-item {
      padding: 15px;
      margin-bottom: 15px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      border-left: 4px solid var(--primary);
      position: relative;
    }
    
    .reservation-item hr {
      border: none;
      border-top: 1px dashed #eee;
      margin: 10px 0;
    }
    
    .reservation-item b {
      color: var(--primary-dark);
    }
    
    .action-buttons {
      display: flex;
      gap: 15px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    
    .capacity-meter {
      height: 8px;
      background-color: #eee;
      border-radius: 4px;
      margin-top: 15px;
      overflow: hidden;
    }
    
    .capacity-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--success), var(--accent));
      width: 0%;
      transition: width 0.5s ease;
    }
    
    .capacity-info {
      display: flex;
      justify-content: space-between;
      margin-top: 5px;
      font-size: 0.8rem;
      color: #666;
    }
    
    @media (max-width: 768px) {
      .calendar {
        grid-template-columns: repeat(4, 1fr);
      }
      
      .container {
        padding: 15px;
      }
    }
    
    @media (max-width: 480px) {
      .calendar {
        grid-template-columns: repeat(3, 1fr);
      }
      
      header h2 {
        font-size: 1.8rem;
      }
    }
    
    @media print {
      header, .calendar, button, footer {
        display: none;
      }
      
      .container {
        background-color: white;
        padding: 0;
        box-shadow: none;
      }
      
      .summary, .form-popup {
        box-shadow: none;
        border: none;
        padding: 0;
      }
    }
    
    /* Animation for calendar dates */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .date {
      animation: fadeIn 0.3s ease forwards;
      opacity: 0;
    }
    
    .date:nth-child(1) { animation-delay: 0.05s; }
    .date:nth-child(2) { animation-delay: 0.1s; }
    .date:nth-child(3) { animation-delay: 0.15s; }
    .date:nth-child(4) { animation-delay: 0.2s; }
    .date:nth-child(5) { animation-delay: 0.25s; }
    .date:nth-child(6) { animation-delay: 0.3s; }
    .date:nth-child(7) { animation-delay: 0.35s; }
    .date:nth-child(8) { animation-delay: 0.4s; }
    .date:nth-child(9) { animation-delay: 0.45s; }
    .date:nth-child(10) { animation-delay: 0.5s; }
    /* Continue for all dates if needed */
  </style>
</head>
<body>

  <header>
    <h2><i class="fas fa-leaf"></i> Sistem Reservasi Dolan Sawah</h2>
    <small>by Ryan</small>
  </header>

  <div class="container">
    <div class="controls">
      <select id="bulanSelect">
        <option value="01"><i class="fas fa-snowflake"></i> Januari</option>
        <option value="02"><i class="fas fa-heart"></i> Februari</option>
        <option value="03"><i class="fas fa-seedling"></i> Maret</option>
        <option value="04"><i class="fas fa-umbrella"></i> April</option>
        <option value="05"><i class="fas fa-tree"></i> Mei</option>
        <option value="06"><i class="fas fa-sun"></i> Juni</option>
        <option value="07"><i class="fas fa-water"></i> Juli</option>
        <option value="08"><i class="fas fa-campground"></i> Agustus</option>
        <option value="09"><i class="fas fa-wind"></i> September</option>
        <option value="10"><i class="fas fa-cloud-rain"></i> Oktober</option>
        <option value="11"><i class="fas fa-cloud-sun"></i> November</option>
        <option value="12"><i class="fas fa-holly-berry"></i> Desember</option>
      </select>
    </div>
    
    <div class="warning" id="warningBox">
      <i class="fas fa-exclamation-triangle"></i> Kapasitas hampir penuh!
    </div>
    
    <div class="calendar" id="calendar"></div>

    <div class="summary" id="summary" style="display:none;"></div>
    
    <div class="form-popup" id="formPopup" style="display:none;">
      <h3><i class="fas fa-calendar-plus"></i> Input Reservasi</h3>
      <label><i class="fas fa-lock"></i> Password: <input type="password" id="adminPass" placeholder="Masukkan password admin"/></label>
      
      <div id="formFields" style="display:none;">
        <label><i class="fas fa-user"></i> Nama: <input type="text" id="nama" placeholder="Nama pemesan"/></label>
        <label><i class="fas fa-clock"></i> Jam Reservasi: <input type="time" id="jam" /></label>
        <label><i class="fas fa-users"></i> Jumlah Peserta: <input type="number" id="jumlah" placeholder="Jumlah orang"/></label>
        <label><i class="fas fa-utensils"></i> Menu: 
          <select id="menu">
            <option>Paket A</option><option>Paket B</option><option>Paket C</option>
            <option>Paket D</option><option>Paket E</option><option>Paket F</option>
            <option>Paket G</option><option>Paket H</option><option>Paket I</option><option>Paket J</option>
            <option>OTS</option><option>Paket Rantang</option>
          </select>
        </label>
        <label><i class="fas fa-map-marker-alt"></i> Tempat:
          <select id="tempat">
            <option>Lantai 1</option><option>Lantai 2</option><option>Lantai 3</option>
            <option>Gubug 1</option><option>Gubug 2</option><option>Gubug 3</option>
          </select>
        </label>
        <label><i class="fas fa-comment-dots"></i> Request Tambahan:
          <textarea id="tambahan" placeholder="Permintaan khusus atau catatan tambahan"></textarea>
        </label>
        <button onclick="simpanReservasi()"><i class="fas fa-save"></i> Simpan Reservasi</button>
      </div>
    </div>

    <div class="action-buttons">
      <button onclick="printData()"><i class="fas fa-print"></i> Print</button>
      <button class="secondary" onclick="shareViaEmail()"><i class="fas fa-envelope"></i> Bagikan via Email</button>
    </div>
  </div>

  <footer>
    <p><i class="fas fa-code"></i> Dibuat <i class="fas fa-heart" style="color: #e76f51;"></i> oleh Ryan</p>
  </footer>

  <script>
    const kapasitasTempat = {
      "Lantai 1": 240, "Lantai 2": 64, "Lantai 3": 112,
      "Gubug 1": 40, "Gubug 2": 15, "Gubug 3": 110,
    };

    const detailMenu = {
      "Paket A": ["Nasi putih", "Ayam kremes", "Sambel", "Lalapan", "Teh", "Es"],
      "Paket B": ["Nasi putih", "Daging kelem", "Bakmi", "Teh", "Es"],
      "Paket C": ["Nasi putih", "Ayam geprek", "Sop Sosis jamur", "Semangka", "Teh", "Es"],
      "Paket D": ["Nasi putih", "Nila bakar", "Sayur asem", "Sambal", "Pisang goreng", "Teh", "Es"],
      "Paket E": ["Nasi putih", "Ayam lada hitam", "Capcay", "Soun jamur", "Bakso kuah", "Kerupuk", "Bolu gulung", "Teh", "Es"],
      "Paket F": ["Steak Ayam", "Kentang goreng", "Wortel + buncis", "Puding Fla", "Soft drink", "Air mineral cup"],
      "Paket G": ["Nasi putih", "Kakap asam manis", "Ayam goreng mentega", "Tumis buncis daging sapi", "Sambal", "Teh", "Es"],
      "Paket H": ["Nasi putih", "Sup iga sapi", "Kerupuk udang", "Sambel kecap", "Tahu + tempe goreng", "Sosis solo", "Bolu gulung", "Teh", "Es", "Air mineral cup"],
      "Paket I": ["Nasi", "Iga bakar", "Sop", "Sambal", "Kerupuk", "Lalapan", "Sosis solo", "Semangka", "Teh", "Es", "Air mineral"],
      "Paket J": ["Nasi", "Sambel goreng ati", "Bihun goreng", "Daging kelem", "Acar kuning", "Kerupuk udang", "Sop Sosis jamur", "Sosis solo", "Pie buah", "Teh", "Softdrink", "Air mineral cup"],
      "OTS": [],
      "Paket Rantang": []
    };

    let dataReservasi = JSON.parse(localStorage.getItem('reservasiDolan')) || {};
    let tanggalDipilih = '';

    const calendarEl = document.getElementById('calendar');
    const warningBox = document.getElementById('warningBox');
    const summaryEl = document.getElementById('summary');
    const formPopup = document.getElementById('formPopup');
    const bulanSelect = document.getElementById('bulanSelect');

    function buatKalender() {
      calendarEl.innerHTML = '';
      const bulan = bulanSelect.value;
      
      // Highlight current month in select
      Array.from(bulanSelect.options).forEach(option => {
        if (option.value === bulan) {
          option.selected = true;
        }
      });
      
      // Create calendar dates
      for (let i = 1; i <= 31; i++) {
        const div = document.createElement('div');
        div.className = 'date';
        div.textContent = i;
        
        const key = `${bulan.padStart(2,'0')}-${String(i).padStart(2, '0')}`;
        if (dataReservasi[key] && dataReservasi[key].length > 0) {
          div.classList.add('has-reservation');
        }
        
        if (key === tanggalDipilih) {
          div.classList.add('selected');
        }
        
        div.onclick = () => pilihTanggal(i);
        calendarEl.appendChild(div);
      }
    }

    function pilihTanggal(tgl) {
      const bulan = bulanSelect.value;
      const key = `${bulan.padStart(2,'0')}-${String(tgl).padStart(2, '0')}`;
      tanggalDipilih = key;
      const data = dataReservasi[key] || [];

      // Update calendar UI
      document.querySelectorAll('.date').forEach(dateEl => {
        dateEl.classList.remove('selected');
        if (dateEl.textContent == tgl) {
          dateEl.classList.add('selected');
        }
      });

      // Calculate capacity
      const totalPeserta = data.reduce((sum, r) => sum + Number(r.jumlah), 0);
      const totalKapasitas = Object.values(kapasitasTempat).reduce((a, b) => a + b, 0);
      const persen = (totalPeserta / totalKapasitas) * 100;

      // Update warning box
      warningBox.style.display = persen > 60 ? 'flex' : 'none';
      if (persen > 60) {
        warningBox.innerHTML = `<i class="fas fa-exclamation-triangle"></i> Kapasitas ${Math.round(persen)}%! Hampir penuh!`;
      }

      // Update capacity meter
      document.querySelector('.capacity-meter')?.remove();
      document.querySelector('.capacity-info')?.remove();
      
      if (totalPeserta > 0) {
        const capacityMeter = document.createElement('div');
        capacityMeter.className = 'capacity-meter';
        capacityMeter.innerHTML = '<div class="capacity-fill" style="width:' + persen + '%"></div>';
        summaryEl.appendChild(capacityMeter);
        
        const capacityInfo = document.createElement('div');
        capacityInfo.className = 'capacity-info';
        capacityInfo.innerHTML = `<span>${totalPeserta} orang terdaftar</span><span>Kapasitas total: ${totalKapasitas} orang</span>`;
        summaryEl.appendChild(capacityInfo);
      }

      // Show reservations
      summaryEl.innerHTML = `<h3><i class="far fa-calendar-alt"></i> Reservasi Tanggal ${key}</h3>`;
      
      if (data.length === 0) {
        summaryEl.innerHTML += `<p style="text-align: center; color: #666; padding: 20px 0;">
          <i class="far fa-calendar-times" style="font-size: 2rem; color: #ccc; margin-bottom: 10px; display: block;"></i>
          Belum ada reservasi untuk tanggal ini
        </p>`;
      } else {
        data.forEach((r, idx) => {
          const isiMenu = detailMenu[r.menu]?.length
            ? detailMenu[r.menu].map(item => `• ${item}`).join('<br/>')
            : "-";
          const div = document.createElement('div');
          div.className = 'reservation-item';
          div.innerHTML = `
            <b><i class="fas fa-user"></i> ${r.nama}</b><br/>
            <span><i class="fas fa-map-marker-alt"></i> ${r.tempat} • <i class="far fa-clock"></i> ${r.jam} • <i class="fas fa-users"></i> ${r.jumlah} orang</span>
            <div class="menu-detail"><b><i class="fas fa-utensils"></i> ${r.menu}:</b>${isiMenu}</div>
            <div><i class="fas fa-comment"></i> <b>Tambahan:</b> ${r.tambahan || '-'}</div>
            <hr/>
            <button class="danger" onclick="hapusReservasi('${key}', ${idx})"><i class="fas fa-trash-alt"></i> Hapus</button>
          `;
          summaryEl.appendChild(div);
        });
      }
      
      summaryEl.style.display = 'block';
      formPopup.style.display = 'block';
      document.getElementById('formFields').style.display = 'none';
      document.getElementById('adminPass').value = '';
      formPopup.setAttribute('data-tanggal', key);
      
      // Scroll to form
      formPopup.scrollIntoView({ behavior: 'smooth' });
    }

    document.getElementById('adminPass').oninput = function() {
      document.getElementById('formFields').style.display = this.value === 'fusion437666' ? 'block' : 'none';
    };

    function simpanReservasi() {
      const key = formPopup.getAttribute('data-tanggal');
      const nama = document.getElementById('nama').value;
      const jam = document.getElementById('jam').value;
      const jumlah = parseInt(document.getElementById('jumlah').value);
      const menu = document.getElementById('menu').value;
      const tempat = document.getElementById('tempat').value;
      const tambahan = document.getElementById('tambahan').value;

      if (!nama || !jam || isNaN(jumlah) || !menu || !tempat) {
        return alert('Harap isi semua field yang diperlukan!');
      }

      const existing = dataReservasi[key] || [];

      // Check for Gubug 1 time conflict
      if (tempat === "Gubug 1") {
        const conflict = existing.some(r =>
          r.tempat === "Gubug 1" &&
          Math.abs(parseFloat(r.jam.replace(":", ".")) - parseFloat(jam.replace(":", "."))) < 3.5
        );
        if (conflict) return alert("Gubug 1 sudah terisi di jam tersebut!");
      }

      existing.push({ nama, jam, jumlah, menu, tempat, tambahan });
      dataReservasi[key] = existing;
      localStorage.setItem('reservasiDolan', JSON.stringify(dataReservasi));
      
      // Show success message
      const successMsg = document.createElement('div');
      successMsg.innerHTML = `<div style="background-color: var(--success); color: white; padding: 10px; border-radius: 5px; margin-top: 10px; text-align: center;">
        <i class="fas fa-check-circle"></i> Reservasi berhasil disimpan!
      </div>`;
      formPopup.appendChild(successMsg);
      
      // Clear form
      document.getElementById('nama').value = '';
      document.getElementById('jam').value = '';
      document.getElementById('jumlah').value = '';
      document.getElementById('tambahan').value = '';
      
      // Remove message after 3 seconds
      setTimeout(() => {
        successMsg.remove();
        pilihTanggal(parseInt(key.split("-")[1]));
      }, 3000);
    }

    function hapusReservasi(tgl, idx) {
      const pass = prompt("Masukkan password admin:");
      if (pass !== 'fusion437666') return alert("Password salah!");

      if (confirm("Apakah Anda yakin ingin menghapus reservasi ini?")) {
        dataReservasi[tgl].splice(idx, 1);
        localStorage.setItem('reservasiDolan', JSON.stringify(dataReservasi));
        pilihTanggal(parseInt(tgl.split("-")[1]));
      }
    }

    function printData() {
      if (!tanggalDipilih || !dataReservasi[tanggalDipilih]) {
        alert("Silakan pilih tanggal terlebih dahulu.");
        return;
      }
      window.print();
    }

    function shareViaEmail() {
      if (!tanggalDipilih || !dataReservasi[tanggalDipilih]) {
        return alert("Silakan pilih tanggal terlebih dahulu.");
      }
      const list = dataReservasi[tanggalDipilih];
      const summary = `Detail Reservasi Dolan Sawah - Tanggal ${tanggalDipilih}:\n\n` + 
        list.map((r, i) => {
          const isi = detailMenu[r.menu]?.length
            ? detailMenu[r.menu].map(x => `     - ${x}`).join('\n')
            : "     - (tanpa detail menu)";
          return (
            `  ${i + 1}. ${r.nama}\n` +
            `     Tempat: ${r.tempat}\n` +
            `     Jam: ${r.jam}\n` +
            `     Jumlah: ${r.jumlah} orang\n` +
            `     Menu: ${r.menu}\n` +
            `${isi}\n` +
            `     Catatan: ${r.tambahan || '-'}\n` +
            `     -----------------------------\n`
          );
        }).join('\n');

      const emailLink = `mailto:?subject=Reservasi ${tanggalDipilih} Dolan Sawah&body=${encodeURIComponent(summary)}`;
      window.location.href = emailLink;
    }

    // Initialize
    bulanSelect.value = new Date().toISOString().slice(5, 7);
    buatKalender();
    
    // Add month change listener
    bulanSelect.addEventListener('change', buatKalender);
  </script>
</body>
</html>