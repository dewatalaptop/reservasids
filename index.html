<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reservasi Dolan Sawah</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background-color: #e0f7fa;
      color: #003f5c;
    }

    header {
      background-color: #005f73;
      color: white;
      padding: 20px;
      text-align: center;
    }

    header small {
      display: block;
      font-size: 10px;
      margin-top: 5px;
      color: #cfe8ec;
    }

    .container {
      padding: 20px;
    }

    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      margin-top: 20px;
    }

    .date {
      background-color: #94d2bd;
      padding: 10px;
      text-align: center;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .date:hover {
      background-color: #0a9396;
      color: white;
    }

    .warning {
      background-color: #ff6b6b;
      color: white;
      padding: 10px;
      margin-top: 10px;
      border-radius: 5px;
      text-align: center;
      display: none;
    }

    .form-popup, .summary {
      margin-top: 20px;
      background-color: #f1faee;
      padding: 15px;
      border-radius: 5px;
    }

    button {
      background-color: #0077b6;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 5px;
    }

    button:hover {
      background-color: #023e8a;
    }

    footer {
      text-align: center;
      font-size: 10px;
      color: #fff;
      background-color: #005f73;
      padding: 10px;
      margin-top: 20px;
    }

    @media print {
      header, .calendar, button, footer {
        display: none;
      }
    }
  </style>
</head>
<body>

  <header>
    <h2>Reservasi Dolan Sawah</h2>
    <small>by Ryan</small>
  </header>

  <div class="container">
    <select id="bulanSelect">
      <option value="01">Januari</option>
      <option value="02">Februari</option>
      <option value="03">Maret</option>
      <option value="04">April</option>
      <option value="05">Mei</option>
      <option value="06">Juni</option>
      <option value="07">Juli</option>
      <option value="08">Agustus</option>
      <option value="09">September</option>
      <option value="10">Oktober</option>
      <option value="11">November</option>
      <option value="12">Desember</option>
    </select>
    <div class="warning" id="warningBox">Kapasitas hampir penuh</div>
    <div class="calendar" id="calendar"></div>

    <div class="summary" id="summary" style="display:none;"></div>
    <div class="form-popup" id="formPopup" style="display:none;">
      <h3>Input Reservasi</h3>
      <label>Password: <input type="password" id="adminPass" /></label><br/>
      <div id="formFields" style="display:none;">
        <label>Nama: <input type="text" id="nama" /></label><br/>
        <label>Jam Reservasi: <input type="time" id="jam" /></label><br/>
        <label>Jumlah Peserta: <input type="number" id="jumlah" /></label><br/>
        <label>Menu: 
          <select id="menu">
            <option>Paket A</option><option>Paket B</option><option>Paket C</option>
            <option>Paket D</option><option>Paket E</option><option>Paket F</option>
            <option>Paket G</option><option>Paket H</option><option>Paket I</option><option>Paket J</option>
          </select>
        </label><br/>
        <label>Tempat:
          <select id="tempat">
            <option>Lantai 1</option>
            <option>Lantai 2</option>
            <option>Lantai 3</option>
            <option>Gubug 1</option>
            <option>Gubug 2</option>
            <option>Gubug 3</option>
          </select>
        </label><br/>
        <label>Request Tambahan:<br/>
          <textarea id="tambahan"></textarea>
        </label><br/>
        <button onclick="simpanReservasi()">Simpan</button>
      </div>
    </div>

    <button onclick="printData()">Print</button>
    <button onclick="shareViaEmail()">Bagikan via Email</button>
  </div>

  <footer>by Ryan</footer>

  <script>
    const kapasitasTempat = {
      "Lantai 1": 240, "Lantai 2": 64, "Lantai 3": 112,
      "Gubug 1": 40, "Gubug 2": 15, "Gubug 3": 110,
    };

    let dataReservasi = JSON.parse(localStorage.getItem('reservasiDolan')) || {};

    const calendarEl = document.getElementById('calendar');
    const warningBox = document.getElementById('warningBox');
    const summaryEl = document.getElementById('summary');
    const formPopup = document.getElementById('formPopup');
    const bulanSelect = document.getElementById('bulanSelect');

    function buatKalender() {
      calendarEl.innerHTML = '';
      for (let i = 1; i <= 31; i++) {
        const div = document.createElement('div');
        div.className = 'date';
        div.textContent = i;
        div.onclick = () => pilihTanggal(i);
        calendarEl.appendChild(div);
      }
    }

    function pilihTanggal(tgl) {
      const bulan = bulanSelect.value;
      const key = `${bulan.padStart(2,'0')}-${String(tgl).padStart(2, '0')}`;
      const data = dataReservasi[key] || [];

      const totalPeserta = data.reduce((sum, r) => sum + Number(r.jumlah), 0);
      const totalKapasitas = Object.values(kapasitasTempat).reduce((a, b) => a + b, 0);
      const persen = (totalPeserta / totalKapasitas) * 100;

      warningBox.style.display = persen > 60 ? 'block' : 'none';

      // tampilkan ringkasan
      summaryEl.innerHTML = `<h3>Reservasi Tanggal ${key}</h3>`;
      data.forEach((r, idx) => {
        const div = document.createElement('div');
        div.innerHTML = `<b>${r.nama}</b> (${r.tempat}, jam ${r.jam}, ${r.jumlah} orang)<br/>
          Menu: ${r.menu}<br/>
          Tambahan: ${r.tambahan || '-'}<br/>
          <button onclick="hapusReservasi('${key}', ${idx})">Hapus</button>`;
        summaryEl.appendChild(div);
      });
      summaryEl.style.display = 'block';

      // tampilkan form input
      formPopup.style.display = 'block';
      document.getElementById('formFields').style.display = 'none';
      document.getElementById('adminPass').value = '';
      formPopup.setAttribute('data-tanggal', key);
    }

    document.getElementById('adminPass').oninput = function () {
      if (this.value === 'fusion437666') {
        document.getElementById('formFields').style.display = 'block';
      } else {
        document.getElementById('formFields').style.display = 'none';
      }
    };

    function simpanReservasi() {
      const key = formPopup.getAttribute('data-tanggal');
      const nama = document.getElementById('nama').value;
      const jam = document.getElementById('jam').value;
      const jumlah = parseInt(document.getElementById('jumlah').value);
      const menu = document.getElementById('menu').value;
      const tempat = document.getElementById('tempat').value;
      const tambahan = document.getElementById('tambahan').value;

      const existing = dataReservasi[key] || [];

      // Cek aturan Gubug 1 hanya 1 reservasi per 3,5 jam
      if (tempat === "Gubug 1") {
        const conflict = existing.some(r => {
          return r.tempat === "Gubug 1" && Math.abs(parseFloat(r.jam.replace(":", ".")) - parseFloat(jam.replace(":", "."))) < 3.5;
        });
        if (conflict) return alert("Gubug 1 sudah terisi di jam tersebut!");
      }

      existing.push({ nama, jam, jumlah, menu, tempat, tambahan });
      dataReservasi[key] = existing;
      localStorage.setItem('reservasiDolan', JSON.stringify(dataReservasi));
      alert("Reservasi berhasil disimpan!");
      pilihTanggal(parseInt(key.split("-")[1]));
    }

    function hapusReservasi(tgl, idx) {
      const pass = prompt("Masukkan password admin:");
      if (pass !== 'fusion437666') return alert("Password salah!");

      dataReservasi[tgl].splice(idx, 1);
      localStorage.setItem('reservasiDolan', JSON.stringify(dataReservasi));
      pilihTanggal(parseInt(tgl.split("-")[1]));
    }

    function printData() {
      window.print();
    }

    function shareViaEmail() {
      const summary = Object.entries(dataReservasi).map(([tanggal, list]) => {
        return `Tanggal ${tanggal}:\n` + list.map((r, i) => (
          `  ${i + 1}. ${r.nama} (${r.tempat}, Jam ${r.jam})\n     Menu: ${r.menu}\n     Tambahan: ${r.tambahan || '-'}`
        )).join('\n');
      }).join('\n\n');

      const emailLink = `mailto:?subject=Data Reservasi Dolan Sawah&body=${encodeURIComponent(summary)}`;
      window.location.href = emailLink;
    }

    bulanSelect.value = new Date().toISOString().slice(5, 7);
    buatKalender();
  </script>
</body>
</html>